<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendar Serviço: {{ service.name }}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>  <!-- Adicionando o jQuery -->
</head>
<body>
    <header>
        <nav>
            <ul>
                <li><a href="{% url 'service_list' %}" class="white-link"><b>Serviços</b></a></li>
            </ul>
        </nav>
    </header>

    <h1>Agendar Serviço: {{ service.name }}</h1>

    <form method="POST">
        {% csrf_token %}

        <label for="name">Seu nome:</label>
        <input type="text" id="name" name="name" required><br><br>

        <label for="email">Seu email:</label>
        <input type="email" id="email" name="email" required><br><br>

        <!-- Listar dias disponíveis -->
        <label for="date">Data do agendamento:</label>
        <select id="date" name="date" required>
            <option value="">Selecione uma data</option>
            {% for day in available_days %}
                <option value="{{ day }}">{{ day }}</option>
            {% endfor %}
        </select><br><br>

        <!-- Adicionar a seleção de horários disponíveis -->
        <label for="time">Horário do agendamento:</label>
        <select id="time" name="time" required>
            <option value="">Por favor, selecione uma data para ver os horários disponíveis</option>
        </select><br><br>

        <button type="submit">Agendar</button>
    </form>

    <footer>
        <p>&copy; 2024 Sistema de Agendamento</p>
    </footer>

    <script>
        $(document).ready(function() {
            $('#date').change(function() {
                var selectedDate = $(this).val();  // Pegar a data selecionada
                var serviceId = {{ service.id }};  // Pegar o ID do serviço

                if (selectedDate) {
                    $.ajax({
                        url: "{% url 'appointment_request' service.id %}",
                        data: {
                            'date': selectedDate
                        },
                        success: function(data) {
                            var timeSelect = $('#time');
                            timeSelect.empty();  // Limpar o select de horários

                            if (data.available_times.length > 0) {
                                // Adicionar os horários disponíveis ao select
                                $.each(data.available_times, function(index, time) {
                                    timeSelect.append('<option value="' + time + '">' + time + '</option>');
                                });
                            } else {
                                // Mostrar mensagem caso não haja horários disponíveis
                                timeSelect.append('<option value="">Nenhum horário disponível</option>');
                            }
                        }
                    });
                }
            });
        });
    </script>
</body>
</html>